<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FENOR | La Ruleta del Infortunio</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Inter:wght@400;600&family=Righteous&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root { --accent: #ff003c; --bg: #050505; --border: #1a1a1a; --gold: #ffd700; --super: #00f2ff; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; scroll-snap-type: y mandatory; overflow-x: hidden; }
        
        section { 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            scroll-snap-align: start; 
            border-bottom: 1px solid var(--border);
            padding: 20px;
            box-sizing: border-box;
        }

        h2 { font-family: 'Syncopate'; font-size: 0.8rem; letter-spacing: 5px; color: var(--accent); margin-bottom: 50px; text-align: center; }

        /* --- PANEL DE GESTI√ìN --- */
        #admin-panel {
            position: fixed;
            top: 20px; left: 20px;
            width: 240px;
            background: rgba(10,10,10,0.95);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent);
            z-index: 9999;
            padding: 15px;
            font-family: 'Inter', sans-serif;
        }
        .admin-title { font-family: 'Syncopate'; font-size: 0.55rem; color: var(--accent); margin-bottom: 15px; display: block; }
        .stat-box { margin-bottom: 15px; }
        .stat-label { font-size: 0.65rem; color: #666; display: block; margin-bottom: 5px; }
        .stat-value { font-family: 'Righteous'; font-size: 1.5rem; color: #fff; }
        .admin-btns { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 4px; margin-top: 10px; }
        .btn-sm { min-width: auto; padding: 8px 2px; font-size: 0.6rem; border-color: #222; }
        
        #jackpot-display { 
            color: var(--gold) !important; 
            cursor: pointer; border: none; background: transparent; 
            width: 100%; text-align: left; font-family: 'Righteous'; 
            font-size: 2.2rem; outline: none; margin: 0; padding: 0;
        }

        .btn-super { 
            width: 100%; 
            margin-top: 10px; 
            border: 1px solid #333; 
            padding: 10px; 
            font-size: 0.55rem !important; 
        }
        .btn-super.active { 
            border-color: var(--super); 
            color: var(--super) !important; 
            box-shadow: 0 0 10px rgba(0,242,255,0.2);
        }

        /* --- RESALTADO DE PREMIO --- */
        .win-duo { 
            color: var(--accent) !important;
            text-shadow: 0 0 15px var(--accent);
            border: 1px solid var(--accent) !important;
        }
        .win-trio {
            color: var(--gold) !important;
            text-shadow: 0 0 20px var(--gold);
            border: 1px solid var(--gold) !important;
            z-index: 2;
        }

        /* --- DISCLAIMER --- */
        #disclaimer-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .disclaimer-card {
            max-width: 550px; background: #0a0a0a; border: 1px solid var(--border);
            border-top: 4px solid var(--accent); padding: 40px; text-align: center;
        }
        .disclaimer-card h3 { font-family: 'Syncopate'; font-size: 0.9rem; color: var(--accent); margin-bottom: 25px; }
        .disclaimer-card p { font-family: 'Inter'; font-size: 0.85rem; line-height: 1.6; color: #aaa; text-align: left; }
        .disclaimer-card b { color: #fff !important; font-weight: 600; }
        .disclaimer-btn { margin-top: 20px; width: 100%; background: var(--accent) !important; color: white !important; border: none !important; font-weight: bold; padding: 15px; cursor: pointer; font-family: 'Syncopate'; font-size: 0.7rem; }

        footer { position: fixed; bottom: 20px; left: 20px; z-index: 1000; }
        .twitch-link { font-family: 'Syncopate'; font-size: 0.6rem; color: #444; text-decoration: none; border: 1px solid #222; padding: 10px 15px; background: rgba(5,5,5,0.8); }

        /* --- DADOS --- */
        .dice-container { display: flex; gap: 80px; justify-content: center; align-items: center; }
        .dice-unit { display: flex; flex-direction: column; align-items: center; gap: 35px; }
        .dice-box { width: 100px; height: 100px; perspective: 1000px; }
        .dice-inner { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: 2.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .dice-face { position: absolute; width: 100px; height: 100px; background: #fff; border: 3px solid #000; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; color: #000; }

        /* --- MONEDAS --- */
        .coins-container { display: flex; gap: 80px; justify-content: center; align-items: center; }
        .coin-unit { display: flex; flex-direction: column; align-items: center; gap: 35px; }
        .coin-inner { width: 160px; height: 160px; position: relative; transform-style: preserve-3d; transition: 3s cubic-bezier(0.15, 0, 0.15, 1); }
        .coin-face { position: absolute; width: 100%; height: 100%; border-radius: 50%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-size: 5rem; border: 5px solid #222; background: #0a0a0a; }

        /* --- TRAGONA --- */
        .slots-machine { display: flex; gap: 20px; background: #000; padding: 25px; border: 4px solid #111; margin-bottom: 40px; transition: 0.5s; }
        .slots-machine.super-active { border-color: var(--super); box-shadow: 0 0 20px rgba(0,242,255,0.1); }
        .slot-col { width: 100px; display: flex; flex-direction: column; gap: 12px; }
        .slot-box { height: 100px; background: #080808; border: 1px solid #222; font-family: 'Righteous'; font-size: 4rem; line-height: 100px; text-align: center; color: #fff; transition: 0.3s; }

        /* --- RULETA --- */
        .wheel-box { position: relative; width: 420px; height: 420px; margin-bottom: 30px; }
        #canvas { width: 100%; height: 100%; border-radius: 50%; border: 10px solid #111; }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 40px solid var(--accent); z-index: 10; filter: drop-shadow(0 0 8px var(--accent)); }

        button { background: transparent; border: 1px solid #333; color: #888; padding: 15px 35px; font-family: 'Syncopate'; font-size: 0.65rem; cursor: pointer; transition: 0.3s; letter-spacing: 2px; min-width: 160px; }
        button:hover { border-color: var(--accent); color: #fff; background: rgba(255,0,60,0.1); }
        input[type="text"] { background: #000; border: 1px solid #222; color: #fff; padding: 15px; width: 400px; text-align: center; font-family: 'Syncopate'; font-size: 0.6rem; margin-bottom: 25px; outline: none; }
        
        #history { position: fixed; bottom: 20px; right: 20px; width: 280px; background: rgba(5,5,5,0.98); border: 1px solid var(--border); border-top: 3px solid var(--accent); z-index: 1000; }
        #history-header { padding: 12px; background: #111; font-family: 'Syncopate'; font-size: 0.5rem; display: flex; justify-content: space-between; cursor: pointer; }
        #log-list { max-height: 300px; overflow-y: auto; }
        .entry { padding: 10px; font-size: 0.75rem; border-bottom: 1px solid #111; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div id="admin-panel">
    <span class="admin-title">GESTI√ìN DE TICKETS</span>
    <div class="stat-box">
        <span class="stat-label">SALDO JUGADOR</span>
        <input type="number" id="player-balance" value="0" style="width: 100%; font-size: 1.5rem; background: transparent; border: none; font-family: 'Righteous'; color: #fff; outline: none;">
        <div class="admin-btns">
            <button class="btn-sm" onclick="adjustBalance(1)">+1</button>
            <button class="btn-sm" onclick="adjustBalance(-1)">-1</button>
            <button class="btn-sm" onclick="adjustBalance(3)">+3</button>
            <button class="btn-sm" onclick="adjustBalance(-3)">-3</button>
            <button class="btn-sm" onclick="adjustBalance(5)">+5</button>
            <button class="btn-sm" onclick="adjustBalance(-5)">-5</button>
        </div>
    </div>
    <div class="stat-box">
        <span class="stat-label">COSTO TRAGONA</span>
        <span id="current-slot-cost" class="stat-value" style="color: var(--accent)">3</span>
    </div>
    <div class="stat-box">
        <span class="stat-label">JACKPOT</span>
        <input type="number" id="jackpot-display" value="0" onchange="updateJackpot(this.value)">
    </div>
    <button id="btnSuperMode" class="btn-super" onclick="toggleSuperMode()">MODO S√öPER</button>
</div>

<div id="disclaimer-overlay">
    <div class="disclaimer-card">
        <h3>ADVERTENCIA</h3>
        <p>Esta herramienta ha sido dise√±ada exclusivamente como <b>din√°mica</b> para recompensar la <b>fidelidad</b> de la comunidad en el canal de Twitch de Fenor. </p>
        <p>Al continuar, confirmas que comprendes que: <br>
           - Los <b>tickets</b> y tiradas <b>no tienen valor econ√≥mico real</b>.<br>
           - Los <b>tickets</b> se obtienen mediante canjeos con puntos del canal (gratuitos), beneficios extras del suscriptor o din√°micas dentro del juego.<br>
           - Las licencias de software se otorgan entre los participantes mediante el azar.<br>
           - No se permite el uso de dinero real para apostar. <b>Es puro entretenimiento.</b></p><br>
        <button class="disclaimer-btn" onclick="document.getElementById('disclaimer-overlay').style.display='none'">ACEPTAR Y CONTINUAR</button>
    </div>
</div>

<footer>
    <a href="https://donfenor.github.io/stream/" target="_blank" class="twitch-link">HUB</a>
</footer>

<audio id="sndDice" src="dados.mp3" preload="auto"></audio>
<audio id="sndCoin" src="moneda.mp3" preload="auto"></audio>
<audio id="sndSlots" src="slots.mp3" preload="auto"></audio>
<audio id="sndWheel" src="ruleta.mp3" preload="auto"></audio>

<div id="history">
    <div id="history-header" onclick="toggleLogs()"><span>HISTORIAL</span><span>[ - ]</span></div>
    <div id="log-list"></div>
</div>

<section>
    <h2>DADOS</h2>
    <div class="dice-container">
        <div class="dice-unit"><div class="dice-box"><div id="dice1" class="dice-inner">
            <div class="dice-face" style="transform:rotateY(0deg) translateZ(50px)">1</div>
            <div class="dice-face" style="transform:rotateY(180deg) translateZ(50px)">2</div>
            <div class="dice-face" style="transform:rotateY(90deg) translateZ(50px)">3</div>
            <div class="dice-face" style="transform:rotateY(-90deg) translateZ(50px)">4</div>
            <div class="dice-face" style="transform:rotateX(90deg) translateZ(50px)">5</div>
            <div class="dice-face" style="transform:rotateX(-90deg) translateZ(50px)">6</div>
        </div></div><button onclick="rollDice(1)">IZQUIERDO</button></div>
        <div class="dice-unit"><div class="dice-box"><div id="dice2" class="dice-inner">
            <div class="dice-face" style="transform:rotateY(0deg) translateZ(50px)">1</div>
            <div class="dice-face" style="transform:rotateY(180deg) translateZ(50px)">2</div>
            <div class="dice-face" style="transform:rotateY(90deg) translateZ(50px)">3</div>
            <div class="dice-face" style="transform:rotateY(-90deg) translateZ(50px)">4</div>
            <div class="dice-face" style="transform:rotateX(90deg) translateZ(50px)">5</div>
            <div class="dice-face" style="transform:rotateX(-90deg) translateZ(50px)">6</div>
        </div></div><button onclick="rollDice(2)">DERECHO</button></div>
    </div>
</section>

<section>
    <h2>MONEDAS</h2>
    <div class="coins-container">
        <div class="coin-unit">
            <div class="coin-inner" id="coin1">
                <div class="coin-face">‚ò†Ô∏è</div>
                <div class="coin-face" style="transform:rotateY(180deg);color:var(--accent)">üêâ</div>
            </div>
            <button onclick="flip(1)">IZQUIERDA</button>
        </div>
        <div class="coin-unit">
            <div class="coin-inner" id="coin2">
                <div class="coin-face">‚ò†Ô∏è</div>
                <div class="coin-face" style="transform:rotateY(180deg);color:var(--accent)">üêâ</div>
            </div>
            <button onclick="flip(2)">DERECHA</button>
        </div>
    </div>
</section>

<section>
    <h2>TRAGONA</h2>
    <div class="slots-machine" id="slots-machine">
        <div class="slot-col" id="col1"><div class="slot-box">-</div><div class="slot-box">-</div><div class="slot-box">-</div></div>
        <div class="slot-col" id="col2"><div class="slot-box">-</div><div class="slot-box">-</div><div class="slot-box">-</div></div>
        <div class="slot-col" id="col3"><div class="slot-box">-</div><div class="slot-box">-</div><div class="slot-box">-</div></div>
    </div>
    <button id="btnSpinSlots" onclick="spinSlots()">EMPEZAR</button>
</section>

<section>
    <h2>RULETA DEL INFORTUNIO</h2>
    <div class="wheel-box"><div class="pointer"></div><canvas id="canvas" width="600" height="600"></canvas></div>
    <input type="text" id="options" value="SUPER, x5, DONA TICKET, TIMEOUT, DADOS, TRAGAPERRAS, DUELO, ROBA TICKET, PIERDE TODO, MONEDAS, DADO DE FENOR, ROBA, X2, X3, INMUNE, ESCUDO, INTERCAMBIO, COMUNISTA " oninput="drawWheel()">
    <button onclick="spinWheel()">GIRAR</button>
</section>

<script>
    let sessionJackpot = 0;
    let currentSlotCost = 3;
    let playerBalance = 0;
    let isSuperMode = false;

    const playSound = (id) => { const s = document.getElementById(id); if(s) { s.currentTime = 0; s.play(); } };
    
    const addLog = (t, r) => {
        const e = document.createElement('div'); e.className = 'entry';
        e.innerHTML = `<span><b style="color:var(--accent)">${t}:</b> ${r}</span><span style="color:#444">${new Date().toLocaleTimeString()}</span>`;
        document.getElementById('log-list').prepend(e);
    };

    function toggleLogs() { const l = document.getElementById('log-list'); l.style.display = l.style.display==='none'?'block':'none'; }
    
    function adjustBalance(amt) { 
        playerBalance = parseInt(document.getElementById('player-balance').value) + amt; 
        if(playerBalance < 0) playerBalance = 0;
        document.getElementById('player-balance').value = playerBalance; 
    }

    function updateJackpot(val) { sessionJackpot = parseInt(val); }
    
    function toggleSuperMode() {
        isSuperMode = !isSuperMode;
        const btn = document.getElementById('btnSuperMode');
        const machine = document.getElementById('slots-machine');
        if(isSuperMode) {
            btn.classList.add('active');
            machine.classList.add('super-active');
            addLog("SISTEMA", "MODO S√öPER ACTIVADO");
        } else {
            btn.classList.remove('active');
            machine.classList.remove('super-active');
            addLog("SISTEMA", "MODO S√öPER DESACTIVADO");
        }
    }

    // VALIDACI√ìN GLOBAL DE SALDO
    function canPlay(cost = 1) {
        if (isSuperMode) return true;
        if (playerBalance >= cost) return true;
        addLog("SISTEMA", "‚ö†Ô∏è SALDO INSUFICIENTE");
        return false;
    }

    // DADOS
    let dX1=0, dY1=0, dX2=0, dY2=0;
    function rollDice(n) {
        if (!canPlay(1)) return;
        if (!isSuperMode) adjustBalance(-1);

        playSound('sndDice'); const r = Math.floor(Math.random()*6);
        const rots = [{x:0,y:0},{x:0,y:180},{x:0,y:-90},{x:0,y:90},{x:-90,y:0},{x:90,y:0}];
        if(n==1){dX1+=1080-(dX1%360)+rots[r].x; dY1+=1080-(dY1%360)+rots[r].y; document.getElementById('dice1').style.transform=`rotateX(${dX1}deg) rotateY(${dY1}deg)`;}
        else{dX2+=1080-(dX2%360)+rots[r].x; dY2+=1080-(dY2%360)+rots[r].y; document.getElementById('dice2').style.transform=`rotateX(${dX2}deg) rotateY(${dY2}deg)`;}
        setTimeout(()=>addLog(n==1?'DADO_IZQ':'DADO_DER', r+1), 2500);
    }

    // MONEDAS
    let c1R=0, c2R=0;
    function flip(n) {
        if (!canPlay(1)) return;
        if (!isSuperMode) adjustBalance(-1);

        playSound('sndCoin'); const side = Math.random()>0.5;
        if(n==1){c1R+=1800+(side?180:0); if(c1R%360!=(side?180:0))c1R+=180; document.getElementById('coin1').style.transform=`rotateY(${c1R}deg)`;}
        else{c2R+=1800+(side?180:0); if(c2R%360!=(side?180:0))c2R+=180; document.getElementById('coin2').style.transform=`rotateY(${c2R}deg)`;}
        setTimeout(()=>addLog(`MONEDA_${n==1?'IZQ':'DER'}`, side?'üêâ':'‚ò†Ô∏è'), 3000);
    }

    // TRAGONA (SLOTS)
    function spinSlots() {
        if (!canPlay(currentSlotCost)) return;
        if (!isSuperMode) adjustBalance(-currentSlotCost);
        
        currentSlotCost++;
        document.getElementById('current-slot-cost').innerText = currentSlotCost;
        sessionJackpot += 3;
        document.getElementById('jackpot-display').value = sessionJackpot;
        
        playSound('sndSlots');
        document.querySelectorAll('.slot-box').forEach(b => b.classList.remove('win-duo', 'win-trio'));
        
        [1,2,3].forEach(c => {
            let count = 0, max = 15 + (c*10);
            const t = setInterval(() => {
                const b = document.getElementById(`col${c}`).children;
                let nums = [0,1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
                for(let i=0; i<3; i++) b[i].innerText = nums[i];
                if(++count > max) { clearInterval(t); if(c==3) checkWinners(); }
            }, 80);
        });
    }

    function checkWinners() {
        const c1 = document.getElementById('col1').children;
        const c2 = document.getElementById('col2').children;
        const c3 = document.getElementById('col3').children;

        const lines = [
            { nodes: [c1[0], c2[0], c3[0]], name: "Horizontal Superior" },
            { nodes: [c1[1], c2[1], c3[1]], name: "Jackpot Central" },
            { nodes: [c1[2], c2[2], c3[2]], name: "Horizontal Inferior" },
            { nodes: [c1[0], c2[1], c3[2]], name: "Diagonal Descendente" },
            { nodes: [c1[2], c2[1], c3[0]], name: "Diagonal Ascendente" }
        ];

        let trios = [];
        let duosCount = 0;

        lines.forEach(line => {
            const v1 = line.nodes[0].innerText, v2 = line.nodes[1].innerText, v3 = line.nodes[2].innerText;
            
            // L√ìGICA DE TR√çOS
            if (v1 === v2 && v2 === v3) {
                line.nodes.forEach(el => el.classList.add('win-trio'));
                trios.push(line.name);
            } 
            // L√ìGICA DE D√öOS
            else {
                let hasDuo = false;
                if (v1 === v2) { line.nodes[0].classList.add('win-duo'); line.nodes[1].classList.add('win-duo'); hasDuo = true; }
                if (v2 === v3) { line.nodes[1].classList.add('win-duo'); line.nodes[2].classList.add('win-duo'); hasDuo = true; }
                
                if (hasDuo) {
                    duosCount++;
                    // SUMAR PREMIO POR D√öO: +3 Tickets
                    adjustBalance(3); 
                }
            }
        });

        if (trios.length > 0) trios.forEach(t => addLog('TRAGONA', `¬°TRIPLE! en ${t}`));
        if (duosCount > 0) addLog('PREMIO', `¬°+${duosCount * 3} Tickets por D√∫os!`);
        if (trios.length === 0 && duosCount === 0) addLog('TRAGONA', 'Nada');
    }

    // RULETA
    const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
    function drawWheel() {
        const opt = document.getElementById('options').value.split(',').map(x => x.trim());
        const arc = (Math.PI*2)/opt.length; ctx.clearRect(0,0,600,600);
        opt.forEach((text, i) => {
            const ang = i * arc - Math.PI/2; ctx.fillStyle = i%2==0 ? '#0a0a0a' : '#151515';
            ctx.beginPath(); ctx.moveTo(300,300); ctx.arc(300,300,295, ang, ang+arc); ctx.fill();
            ctx.save(); ctx.translate(300,300); ctx.rotate(ang + arc/2);
            ctx.textAlign="right"; ctx.fillStyle="#fff"; ctx.font="bold 20px Syncopate";
            ctx.fillText(text.toUpperCase(), 270, 10); ctx.restore();
        });
    }

    let currentRot = 0;
    function spinWheel() {
        // VALIDACI√ìN: Solo gira si tiene saldo (cuesta 1 ticket)
        if (!canPlay(1)) return;
        if (!isSuperMode) adjustBalance(-1);

        currentSlotCost = 3; 
        document.getElementById('current-slot-cost').innerText = currentSlotCost;
        playSound('sndWheel');
        const opt = document.getElementById('options').value.split(',').map(x => x.trim());
        const resIdx = Math.floor(Math.random()*opt.length);
        const arcDeg = 360/opt.length;
        currentRot += 3600 + (360 - (resIdx * arcDeg)) - (arcDeg/2) - (currentRot%360);
        gsap.to(canvas, { rotation: currentRot, duration: 5, ease: "power4.out", onComplete: () => addLog('RULETA', opt[resIdx].toUpperCase()) });
    }
    window.onload = drawWheel;

    // CONTROL TOTAL POR TECLADO
    window.addEventListener('keydown', (event) => {
        if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'NUMBER') return;

        // 1. AJUSTE DE SALDO
        if (event.key === 'ArrowUp') {
            event.preventDefault(); adjustBalance(1); addLog("TECLADO", "+1 Ticket"); return; 
        }
        if (event.key === 'ArrowDown') {
            event.preventDefault(); adjustBalance(-1); addLog("TECLADO", "-1 Ticket"); return;
        }

        // 2. ACCIONES DIN√ÅMICAS
        if (['ArrowLeft', 'ArrowRight', ' '].includes(event.key)) {
            event.preventDefault();
            const sections = document.querySelectorAll('section');
            let currentSection = null;
            sections.forEach(sec => {
                const rect = sec.getBoundingClientRect();
                if (rect.top >= -200 && rect.top <= 200) currentSection = sec;
            });

            if (currentSection) {
                const buttons = currentSection.querySelectorAll('button');
                if (buttons.length > 1) {
                    if (event.key === 'ArrowLeft') buttons[0].click();
                    if (event.key === 'ArrowRight') buttons[1].click();
                    if (event.key === ' ') { buttons[0].click(); buttons[1].click(); }
                } else if (buttons.length === 1) {
                    buttons[0].click();
                }
            }
        }
    });
</script>
</body>
</html>
